#data wrangling, remove unknown income, select columns, pivot into desired table
#arrange income categories by amount, calculate attricion rate.
bank_churners %>%
filter(
Income_Category == c("$120K +","$80K - $120K",
"$60K - $80K","$40K - $60K", "Less than $40K")
)%>%
select(Attrition_Flag, Income_Category) %>%
count(Attrition_Flag, Income_Category) %>%
pivot_wider(names_from = "Attrition_Flag", values_from = n) %>%
arrange(
fct_relevel(Income_Category, "$120K +","$80K - $120K",
"$60K - $80K","$40K - $60K", "Less than $40K"))%>%
mutate(rate = `Attrited Customer`/(`Attrited Customer`+`Existing Customer`))%>%
print() %>%
#plot data
ggplot(aes(x = rate, y = fct_relevel(Income_Category, "$120K +","$80K - $120K",
"$60K - $80K","$40K - $60K", "Less than $40K"))) +
geom_point()+
#format axes, title, and theme selection
scale_y_discrete(name = NULL) +
scale_x_continuous(
name = "Attrition Fraction" ,
limits = c(0, 0.2),
expand = expansion(mult = c(0.01, 0.06))
) +
theme_bw()
#Wrangle data for members with college degree. Count by each degree for each
#gender and print summary table:
my_bank<-bank_churners %>%
filter(Education_Level == c("College", "Post-Graduate", "Doctorate"))%>%
filter(Gender == c("M","F"))%>%
count(Education_Level, Gender)%>%
pivot_wider(names_from = "Gender", values_from = n)%>%
print()
#Plot pie chart by each degree for males.
ggplot(my_bank,aes(x = M, y = "abc", fill = Education_Level)) +
geom_col(position = "fill") +
coord_polar() +
#remove scale, select theme, title, color scale, and legend name.
scale_x_continuous(
name = NULL, breaks = NULL
) +
scale_y_discrete(
name = NULL, breaks = NULL
) +
theme_bw()+
scale_fill_manual(
values = c("#E69F00", "#56B4E9", "#009E73"),
name = "Level of Education") +
ggtitle("College Education for Males")
#Plot pie chart by each degree for females.
ggplot(my_bank,aes(x = F, y = "abc", fill = Education_Level)) +
geom_col(position = "fill") +
coord_polar() +
#remove scale, select theme, title, color scale, and legend name.
scale_x_continuous(
name = NULL, breaks = NULL
) +
scale_y_discrete(
name = NULL, breaks = NULL
) +
theme_bw()+
scale_fill_manual(
values = c("#E69F00", "#56B4E9", "#009E73"),
name = "Level of Education") +
ggtitle("College Education for Females")
#data wrangling, remove unknown income, select columns, pivot into desired table
#arrange income categories by amount, calculate attricion rate.
bank_churners %>%
filter(
Income_Category == c("$120K +","$80K - $120K",
"$60K - $80K","$40K - $60K", "Less than $40K")
)%>%
select(Attrition_Flag, Income_Category) %>%
count(Attrition_Flag, Income_Category) %>%
pivot_wider(names_from = "Attrition_Flag", values_from = n) %>%
arrange(
fct_relevel(Income_Category, "$120K +","$80K - $120K",
"$60K - $80K","$40K - $60K", "Less than $40K"))%>%
mutate(rate = `Attrited Customer`/(`Attrited Customer`+`Existing Customer`))%>%
print()
#plot data
ggplot(aes(x = rate, y = fct_relevel(Income_Category, "$120K +","$80K - $120K",
"$60K - $80K","$40K - $60K", "Less than $40K"))) +
geom_point()+
#format axes, title, and theme selection
scale_y_discrete(name = NULL) +
scale_x_continuous(
name = "Attrition Fraction" ,
limits = c(0, 0.2),
expand = expansion(mult = c(0.01, 0.06))
) +
theme_bw()
#data wrangling, remove unknown income, select columns, pivot into desired table
#arrange income categories by amount, calculate attricion rate.
new <- bank_churners %>%
filter(
Income_Category == c("$120K +","$80K - $120K",
"$60K - $80K","$40K - $60K", "Less than $40K")
)%>%
select(Attrition_Flag, Income_Category) %>%
count(Attrition_Flag, Income_Category) %>%
pivot_wider(names_from = "Attrition_Flag", values_from = n) %>%
arrange(
fct_relevel(Income_Category, "$120K +","$80K - $120K",
"$60K - $80K","$40K - $60K", "Less than $40K"))%>%
mutate(rate = `Attrited Customer`/(`Attrited Customer`+`Existing Customer`))%>%
print()
#plot data
new %>%
ggplot(aes(x = rate, y = fct_relevel(Income_Category, "$120K +","$80K - $120K",
"$60K - $80K","$40K - $60K", "Less than $40K"))) +
geom_point()+
#format axes, title, and theme selection
scale_y_discrete(name = NULL) +
scale_x_continuous(
name = "Attrition Fraction" ,
limits = c(0, 0.2),
expand = expansion(mult = c(0.01, 0.06))
) +
theme_bw()
#data wrangling, remove unknown income, select columns, pivot into desired table
#arrange income categories by amount, calculate attricion rate.
new <- bank_churners %>%
filter(
Income_Category == c("$120K +","$80K - $120K",
"$60K - $80K","$40K - $60K", "Less than $40K")
)%>%
select(Attrition_Flag, Income_Category) %>%
count(Attrition_Flag, Income_Category) %>%
pivot_wider(names_from = "Attrition_Flag", values_from = n) %>%
arrange(
fct_relevel(Income_Category, "$120K +","$80K - $120K",
"$60K - $80K","$40K - $60K", "Less than $40K"))%>%
mutate(rate = `Attrited Customer`/(`Attrited Customer`+`Existing Customer`))%>%
new
#data wrangling, remove unknown income, select columns, pivot into desired table
#arrange income categories by amount, calculate attricion rate.
new <- bank_churners %>%
filter(
Income_Category == c("$120K +","$80K - $120K",
"$60K - $80K","$40K - $60K", "Less than $40K")
)%>%
select(Attrition_Flag, Income_Category) %>%
count(Attrition_Flag, Income_Category) %>%
pivot_wider(names_from = "Attrition_Flag", values_from = n) %>%
arrange(
fct_relevel(Income_Category, "$120K +","$80K - $120K",
"$60K - $80K","$40K - $60K", "Less than $40K"))%>%
mutate(rate = `Attrited Customer`/(`Attrited Customer`+`Existing Customer`))
new
#plot data
new %>%
ggplot(aes(x = rate, y = fct_relevel(Income_Category, "$120K +","$80K - $120K",
"$60K - $80K","$40K - $60K", "Less than $40K"))) +
geom_point()+
#format axes, title, and theme selection
scale_y_discrete(name = NULL) +
scale_x_continuous(
name = "Attrition Fraction" ,
limits = c(0, 0.2),
expand = expansion(mult = c(0.01, 0.06))
) +
theme_bw()
#data wrangling, remove unknown income, select columns, pivot into desired table
#arrange income categories by amount, calculate attricion rate.
new <- bank_churners %>%
filter(
Income_Category != "Unknown")
)%>%
#data wrangling, remove unknown income, select columns, pivot into desired table
#arrange income categories by amount, calculate attricion rate.
new <- bank_churners %>%
filter(
Income_Category != "Unknown")%>%
select(Attrition_Flag, Income_Category) %>%
count(Attrition_Flag, Income_Category) %>%
pivot_wider(names_from = "Attrition_Flag", values_from = n) %>%
arrange(
fct_relevel(Income_Category, "$120K +","$80K - $120K",
"$60K - $80K","$40K - $60K", "Less than $40K"))%>%
mutate(rate = `Attrited Customer`/(`Attrited Customer`+`Existing Customer`))
new
#plot data
new %>%
ggplot(aes(x = rate, y = fct_relevel(Income_Category, "$120K +","$80K - $120K",
"$60K - $80K","$40K - $60K", "Less than $40K"))) +
geom_point()+
#format axes, title, and theme selection
scale_y_discrete(name = NULL) +
scale_x_continuous(
name = "Attrition Fraction" ,
limits = c(0, 0.2),
expand = expansion(mult = c(0.01, 0.06))
) +
theme_bw()
#data wrangling, remove unknown income, select columns, pivot into desired table
#arrange income categories by amount, calculate attricion rate.
bank_churners %>%
filter(
Income_Category %in% c("$120K +","$80K - $120K",
"$60K - $80K","$40K - $60K", "Less than $40K")
)%>%
select(Attrition_Flag, Income_Category) %>%
count(Attrition_Flag, Income_Category) %>%
pivot_wider(names_from = "Attrition_Flag", values_from = n) %>%
arrange(
fct_relevel(Income_Category, "$120K +","$80K - $120K",
"$60K - $80K","$40K - $60K", "Less than $40K"))%>%
mutate(rate = `Attrited Customer`/(`Attrited Customer`+`Existing Customer`))%>%
print() %>%
#plot data
ggplot(aes(x = rate, y = fct_relevel(Income_Category, "$120K +","$80K - $120K",
"$60K - $80K","$40K - $60K", "Less than $40K"))) +
geom_point()+
#format axes, title, and theme selection
scale_y_discrete(name = NULL) +
scale_x_continuous(
name = "Attrition Fraction" ,
limits = c(0, 0.2),
expand = expansion(mult = c(0.01, 0.06))
) +
theme_bw()
library(tidyverse)
library(colorspace)
library(ggridges)
knitr::opts_chunk$set(echo = TRUE)
bank_churners <- readr::read_csv("https://wilkelab.org/SDS375/datasets/bank_churners.csv")
bank_churners
summary <- bank_churners %>%
# remove observations with an unknown income level
filter(Income_Category != "Unknown") %>%
# group by relevant variables
group_by(Attrition_Flag, Income_Category) %>%
summarise(count = n()) %>%
# reorder income greatest to least
arrange(fct_relevel(Income_Category, "$120K +", "$80K - $120K", "$60K - $80K", "$40K - $60K", "Less than $40K")) %>%
# rearrange table
pivot_wider(names_from = Attrition_Flag, values_from = count)
print(summary)
# prepare data
bank_churners %>%
filter(Income_Category != "Unknown") %>%
# reorder income levels from least to greatest
mutate("Reordered_Income" = fct_relevel(Income_Category, "Less than $40K","$40K - $60K","$60K - $80K","$80K - $120K", "$120K +")) %>%
# plot stacked barplot
ggplot(aes(Reordered_Income, fill = Attrition_Flag)) +
# label plot
geom_bar(position = "fill") +
labs(fill = "Customer Status") +
ylab("Proportion") +
xlab("Income Level") +
ggtitle("Customer Status by Income Level") +
theme_classic()
# summary table
table <- bank_churners %>%
select(Marital_Status, Gender, Credit_Limit) %>%
filter(Marital_Status != "Unknown") %>%
# group by relevant variables
group_by(Marital_Status, Gender)
head(table)
# ridge line plot
ggplot(table, aes(y=Marital_Status, x=Credit_Limit, fill = Gender)) +
geom_density_ridges(alpha = 0.5) +
ggtitle("Credit Limit by Marital Status") +
ylab("Marital Status") +
xlab("Credit Limit") +
theme_minimal()
# summary table
table <- bank_churners %>%
select(Marital_Status, Gender, Credit_Limit) %>%
filter(Marital_Status != "Unknown") %>%
# group by relevant variables
head(table)
# summary table
table <- bank_churners %>%
select(Marital_Status, Gender, Credit_Limit) %>%
filter(Marital_Status != "Unknown")
# group by relevant variables
head(table)
# ridge line plot
ggplot(table, aes(y=Marital_Status, x=Credit_Limit, fill = Gender)) +
geom_density_ridges(alpha = 0.5) +
ggtitle("Credit Limit by Marital Status") +
ylab("Marital Status") +
xlab("Credit Limit") +
theme_minimal()
library(tidyverse)
library(colorspace)
library(cowplot)
knitr::opts_chunk$set(echo = TRUE)
bank_churners <- readr::read_csv("https://wilkelab.org/SDS375/datasets/bank_churners.csv")
bank_churners
bank_churners %>%
filter(Income_Category != 'Unknown') %>% # remove the income level Unknown
mutate(Income_Category = fct_relevel(Income_Category, 'Less than $40K',
'$40K - $60K',
'$60K - $80K',
'$80K - $120K',
'$120K +')) %>%
count(Income_Category, Attrition_Flag) %>%
pivot_wider(names_from = 'Attrition_Flag', values_from = 'n') %>%
rename('Income Category' = `Income_Category`) # remove underscore from column name
bank_churners %>%
filter(Income_Category != 'Unknown') %>% # remove the income level Unknown
mutate(Income_Category = fct_relevel(Income_Category, 'Less than $40K',
'$40K - $60K',
'$60K - $80K',
'$80K - $120K',
'$120K +')) %>%
ggplot(aes(y = Income_Category, fill = Attrition_Flag)) +
geom_bar(position = "fill") +
scale_x_continuous(
name = 'Proportion of Customers',
expand = expansion(mult = c(0, 0))
) +
scale_y_discrete(
name = 'Income Level'
) +
scale_fill_manual(
name = 'Attrition Flag',
values = c("#E69F00", "#56B4E9")
) +
theme_minimal_vgrid()
bank_churners %>%
# separate customers into age groups of 10 years
mutate(Age_Group = factor(Customer_Age %/% 10 * 10)) %>%
group_by(Age_Group) %>%
summarize(
'Number of Customers' = n(),  # n() returns the number of observations per group
'Mean Transaction Count' = mean(Total_Trans_Ct)
) %>%
rename('Age Group' = `Age_Group`) # remove underscore from column name
bank_churners %>%
mutate(Age_Group = factor(Customer_Age %/% 10 * 10)) %>%
ggplot(aes(y = Age_Group, x = Total_Trans_Ct, fill = Age_Group)) +
geom_boxplot() +
scale_x_continuous(
name = "Total Transaction Count"
) +
scale_y_discrete(
name = "Age Group"
) +
scale_fill_discrete_sequential(
palette = "Sunset"
) +
theme_minimal_grid() +
theme(
legend.position = "none"
)
library(tidyverse)
library(colorspace)
knitr::opts_chunk$set(echo = TRUE)
bank_churners <- readr::read_csv("https://wilkelab.org/SDS375/datasets/bank_churners.csv")
bank_churners
Income_attrition <- bank_churners %>%
filter(Income_Category != "Unknown") %>%
mutate(Income_Category = fct_relevel(Income_Category, "Less than $40K", "$40K - $60K", "$60K - $80K",
"$80K - $120K", "$120K +")) %>%
select(Income_Category, Attrition_Flag) %>%
count(Income_Category, Attrition_Flag) %>%
pivot_wider(names_from = "Attrition_Flag", values_from = "n")
head(Income_attrition)
Income_graph <- bank_churners %>%
filter(Income_Category != "Unknown") %>%
mutate(Income_Category = fct_relevel(Income_Category, "Less than $40K", "$40K - $60K", "$60K - $80K",
"$80K - $120K", "$120K +")) %>%
select(Income_Category, Attrition_Flag) %>%
count(Income_Category, Attrition_Flag)
ggplot(Income_graph, aes(Income_Category, n, fill = factor(Attrition_Flag))) +
geom_bar(stat = "identity", position = "dodge") +
scale_fill_discrete(name = "Customer Status",
labels = c("Attrited", "Existing")) +
scale_x_discrete(name = "Customer Income Level") +
scale_y_continuous(name = "# of Customers") +
theme_grey() +
theme(axis.title.y = element_text(size = 9),
axis.title.x = element_text(size = 9),
legend.position = c(.85, .83),
legend.box.background = element_rect(color = "black"))
MaleCount <- bank_churners %>%
filter(Gender == "M") %>%
filter(Education_Level != "Unknown") %>%
mutate(Education_Level = fct_relevel(Education_Level, "Uneducated", "High School", "College", "Graduate",
"Post-Graduate", "Doctorate")) %>%
select(Gender, Education_Level) %>%
count(Gender, Education_Level)
FemaleCount <- bank_churners %>%
filter(Gender == "F") %>%
filter(Education_Level != "Unknown") %>%
mutate(Education_Level = fct_relevel(Education_Level, "Uneducated", "High School", "College", "Graduate",
"Post-Graduate", "Doctorate")) %>%
select(Gender, Education_Level) %>%
count(Gender, Education_Level)
library(viridis)
library(ggforce)
ggplot(MaleCount) +
aes(x0 = 0, y0 =0,
r0 = 0, r = 1,
amount = n,
fill = Education_Level) +
geom_arc_bar(stat = "pie") +
scale_color_viridis(discrete = TRUE) +
theme_no_axes() +
ggtitle("Proportional Education Levels for Males")
ggplot(FemaleCount) +
aes(x0 = 0, y0 =0,
r0 = 0, r = 1,
amount = n,
fill = Education_Level) +
geom_arc_bar(stat = "pie") +
scale_color_viridis(discrete = TRUE) +
theme_no_axes() +
ggtitle("Proportional Education Levels for Females")
Count <- bank_churners %>%
filter(Education_Level != "Unknown") %>%
mutate(Education_Level = fct_relevel(Education_Level, "Uneducated", "High School", "College", "Graduate",
"Post-Graduate", "Doctorate")) %>%
select(Gender, Education_Level) %>%
count(Gender, Education_Level)
MaleCount <- bank_churners %>%
filter(Gender == "M") %>%
filter(Education_Level != "Unknown") %>%
mutate(Education_Level = fct_relevel(Education_Level, "Uneducated", "High School", "College", "Graduate",
"Post-Graduate", "Doctorate")) %>%
select(Gender, Education_Level) %>%
count(Gender, Education_Level)
FemaleCount <- bank_churners %>%
filter(Gender == "F") %>%
filter(Education_Level != "Unknown") %>%
mutate(Education_Level = fct_relevel(Education_Level, "Uneducated", "High School", "College", "Graduate",
"Post-Graduate", "Doctorate")) %>%
select(Gender, Education_Level) %>%
count(Gender, Education_Level)
Count <- bank_churners %>%
filter(Education_Level != "Unknown") %>%
mutate(Education_Level = fct_relevel(Education_Level, "Uneducated", "High School", "College", "Graduate",
"Post-Graduate", "Doctorate")) %>%
select(Gender, Education_Level) %>%
count(Gender, Education_Level)
library(viridis)
library(ggforce)
ggplot(Count) +
aes(x0 = 0, y0 =0,
r0 = 0, r = 1,
amount = n,
fill = Education_Level) +
geom_arc_bar(stat = "pie") +
scale_color_viridis(discrete = TRUE) +
facet_wrap(vars(Gender))
theme_no_axes() +
ggtitle("Proportional Education Levels for Males")
ggplot(FemaleCount) +
aes(x0 = 0, y0 =0,
r0 = 0, r = 1,
amount = n,
fill = Education_Level) +
geom_arc_bar(stat = "pie") +
scale_color_viridis(discrete = TRUE) +
theme_no_axes() +
ggtitle("Proportional Education Levels for Females")
library(tidyverse)
library(colorspace)
knitr::opts_chunk$set(echo = TRUE)
bank_churners <- readr::read_csv("https://wilkelab.org/SDS375/datasets/bank_churners.csv")
bank_churners
#create summary table
bank_table<-bank_churners%>%
filter(Income_Category!="Unknown")%>%  #remove missing values
group_by(Income_Category,Attrition_Flag)%>%  #create groups
select(Income_Category,Attrition_Flag)%>%
count(Income_Category,Attrition_Flag)%>%
#set the order of table from less to more income
arrange(desc(Income_Category=fct_relevel(Income_Category,
"Less than $40K",
"$40K - $60K",
"$60K - $80K",
"$80K - $120K",
"$120K +")))%>%
pivot_wider(names_from = "Attrition_Flag",values_from="n")%>% #make the table
print(bank_table)
#create plot
bank_churners%>%
filter(Income_Category!="Unknown")%>%  #remove missing values
#set the order of each stacked bar
mutate(Income_Category=fct_relevel(Income_Category,
"Less than $40K",
"$40K - $60K",
"$60K - $80K",
"$80K - $120K","$120K +"))%>%
ggplot(aes(y=Income_Category,fill=Attrition_Flag))+geom_bar(position="fill")+
theme_bw(12)+  #create plot and set themes
scale_x_continuous(name="Proportion",limits=c(0,1),expand=c(0,0))+
scale_y_discrete(name="Income Category",expand=c(0,0))
library(ggforce)  #to use geom_arc_bar() to draw pie chart
#create table
bank_churners%>%
count(Card_Category,Gender)%>%
pivot_wider(names_from = "Gender",values_from="n")  #make table
#create plot
bank_churners%>%
count(Card_Category,Gender)%>%
ggplot()+  #make pie chart
aes(x0=0,y0=0,r0=0,r=1,
amount = n,
fill = Card_Category)+
geom_arc_bar(stat = "pie")+
#make facets and set label of each facet
facet_wrap(~Gender, labeller = as_labeller(c('M' = "Male", 'F' = "Female")))+
theme_void()+
coord_fixed()
